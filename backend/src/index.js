"use strict";var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:true});const express_1=__importDefault(require("express"));const multer_1=__importDefault(require("multer"));const cors_1=__importDefault(require("cors"));const logger_1=require("./logger");const db_connection_1=require("./db_connection");const login_1=__importDefault(require("./login"));const morgan_1=__importDefault(require("morgan"));const fs_1=__importDefault(require("fs"));const path_1=__importDefault(require("path"));const app=express_1.default();const port=3002;db_connection_1.connectToDB(5);if(!fs_1.default.existsSync(path_1.default.join(__dirname,"../","logs")))fs_1.default.mkdirSync(path_1.default.join(__dirname,"../","logs"));fs_1.default.appendFileSync(path_1.default.join(__dirname,"../","logs/","access.log"),"");app.use(express_1.default.static(path_1.default.resolve(__dirname,"../client/build")));app.use(morgan_1.default(function(tokens,req,res){return[tokens.method(req,res),tokens.url(req,res),tokens.status(req,res),tokens.res(req,res,"content-length"),"-",tokens["response-time"](req,res),"ms"].join(" ")}));app.use((req,res,next)=>{logger_1.logger.info(`${req.method} ${req.originalUrl}`);next()});app.use(cors_1.default());app.use("/login",login_1.default);app.use((err,req,res,next)=>{var _a;if(err&&err instanceof multer_1.default.MulterError){logger_1.logger.error(err.message);res.status(400).send(err.message);return next()}else if(err&&((_a=err.message)===null||_a===void 0?void 0:_a.localeCompare("Wrong File Format"))===0){if(!res.headersSent)res.status(400).send("Wrong File Format");logger_1.logger.error(err.message);return next()}if(!res.headersSent)res.status(500).send("Unknown Error");logger_1.logger.error(err.message);return next()});app.listen(port,()=>{logger_1.logger.info(`listening on port ${port}`)});
